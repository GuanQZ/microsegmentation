# 已知问题与风险清单

本文档集中记录当前实现的已知问题、风险与影响范围，便于在保证核心功能优先的前提下，后续逐步补齐。

## 1. 连接状态跟踪未处理（已解决）
- 现状：已在入/出向根链放行 `ESTABLISHED,RELATED` 的返回流量。
- 影响：该问题已消除。
- 影响范围：无。

## 2. 仅覆盖 FORWARD 链
- 现状：规则仅挂载在 filter 表的 `FORWARD` 链。
- 影响：
  - `hostNetwork` 或 Node 本机流量不会进入 `FORWARD`，可能绕过策略；
  - 某些 CNI/代理的链路若在 `FORWARD` 前已 ACCEPT，可能导致策略不生效。
- 影响范围：宿主机/hostNetwork 场景与复杂链路场景。

## 3. ipset 清理与收敛
- 现状：ipset 只做创建与同步；未清理已不再使用的集合。
- 影响：长期运行可能累积无用集合（集合名冲突风险、运维复杂度增加）。
- 影响范围：频繁变更策略或频繁扩缩 Deployment 的集群。

## 4. 白名单集合为空时的默认行为
- 现状：若某 Deployment 配置了白名单，但白名单内引用的目标/来源当前无 Pod，规则会导致“全部拒绝”。
- 影响：可能出现“策略配置正确但暂时无实例时误拦截”。
- 影响范围：弹性伸缩与滚动升级期间。

## 5. 规则刷新是全量覆盖
- 现状：每次 Sync 都对链进行全量 `-F` + `-A` 重建。
- 影响：规则量较大时，更新耗时增加；短窗口内可能存在临时不一致。
- 影响范围：大规模 Pod/规则集。

## 6. 规则规模与性能
- 现状：已引入 ipset 减少规则膨胀，但仍为每个 Pod 生成入/出向规则。
- 影响：Pod 数量大时链长度增长，匹配耗时增加。
- 影响范围：大规模集群。

## 7. 依赖系统工具
- 现状：依赖 `iptables`/`ipset` 二进制与 `NET_ADMIN` 权限。
- 影响：镜像缺失或权限不足会直接失败。
- 影响范围：部署与运行时环境。

---

> 说明：本清单用于记录问题，不影响当前“核心功能优先”的迭代方向。
